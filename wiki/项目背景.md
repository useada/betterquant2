### 项目简介
&emsp;&emsp;打造一个高质量的量化交易系统是一个很复杂的过程，复杂度主要来源于两方面：技术和业务规则，基于这两点，在我的从业经历里也踩了很多坑。2018年我从传统金融行业进入加密行业的量化，带领团队开发了一套数字货币的量化交易系统，虽然这一整套c++开发的系统也能在云端7*24小时无故障运行，同时也为公司带来了不错的效益，但是由于很多衍生品的业务规则和基本参数和国内传统行业交易品种有着比较大的不同，经过几轮迭代之后，每次业务部门来了新的需求，能实现但是周期都不尽如人意。虽然从领导和非技术人员的角度来看，系统还不错，能稳定运行也能创造效益，但是从我们专业的，追求完美代码的工程师视角，还是有很多可以继续改进的地方。

&emsp;&emsp;2022年我离开原来的公司，有了一些自己的时间，于是着手开发一套高质量的量化交易系统，基于之前十来年量化私募的工作经验和踩过的坑，我重写了整个交易系统，在满足需求的前提下尽可能的控制系统的复杂度，将代码量控制在了八万行以内。从代码质量的角度来看，鲜有超过50行代码的函数或者超过500行代码的类，整个系统由七个子系统和两百多个小模块构成，没有一个全局变量。因为没有kpi也没有考核，唯一的目标是打造一个完美的系统，所以我可以花一个多月的时间对系统进行一次全面的深度重构，每一次修改，如《Clean code》作者 Robert C. Martin 所言 "When you leave, keep the camp cleaner than when you arrived"，系统也进入了一种正向的循环。  

&emsp;&emsp;目前系统可以快速接入各种交易柜台，由于分离出公共部分，两三天就可以接入一个新的交易柜台，系统能很好的帮你处理柜台的各种异常状况，比如一些不成熟的柜台或者接口的成交回报或者委托回报的乱序问题等等，系统内置强大的状态机可以自动帮你处理这些问题，使得你在接入这些新的api不再需要耗费精力关注这些业务细节。   

### 项目优势
&emsp;&emsp;以我对这个行业十多年的了解，很多量化私募对于系统的要求仅仅停留在可以运行的级别，没有代码质量可言，甚至我听说还有规模不小的私募基金，系统在盘中经常有不明原因的crash，事后也查不出什么原因，对于交易系统来说，这是难以想象的。  

&emsp;&emsp;我们有很多同行虽然专业技能过硬，但是对于二级市场期现交易结算业务并不是特别熟悉，有一点可以肯定的是，量化交易系统和很多软件系统不一样，起码有一半以上的复杂度体现在业务上，所以说要打造一套完美的系统，不精通业务和需求是不可能做到的。BetterQuant是我在二级市场领域深耕二十多年经验的积累，因为唯一的追求就是打造一个尽可能完美的系统，因此稍微有一些设计或者代码上的不满意我马上就会对其进行重构。  

&emsp;&emsp;基于高质量的架构和代码，最明显的效果是来了需求能够快速实现，原本系统资金账户下不能开设多个交易账户，但是我在一个小时之内把代码改完，一天之内测试完毕上线，还有pnl监控和和黑白名单两个风控插件三天之内就搞定开发加测试。当然从[概述](HOME#概述)我们可以看到BetterQuant的优势远远不止这些！如果你打算在量化领域大展身手，组建一个有战斗力的团队，相信我，你正在做我五年前做的事情，现在你不再需要组建和维持一个研发团队，一流的系统也是现成的。二级市场尤其是期货市场就是战场，所以请带上巴雷特再和那些小米加步枪战斗吧！   

### 设计理念
&emsp;&emsp; 和国内传统的交易系统不一样BetterQuant没有成交回报，只有委托回报，这个设计大大减少了系统的复杂度，系统内不再需要处理成交回报和委托回报的一致性以及各种乱序等问题，系统内的状态机把成交回报和委托回报合并到了一起，目前的设计中委托回报包含了最后一笔的成交信息，有经验的交易系统开发者可能会问，只有最后一笔成交明细那么系统crash之后怎么重建仓位信息？BetterQuant用一个很巧妙的设计解决了这个问题。使得即使系统崩溃，仓位信息仍然可以正常重建。  

&emsp;&emsp; [订单信息](策略引擎#订单信息)是一个包含很多字段的数据结构，关于这一点是基于这样的设计理念，当策略引擎收到下单请求之后，会在系统内生成一张"巨大的"订单，这张订单包含了此订单在系统内流转过程中各个环节需要用到的字段，比如说风控和盈亏监控会用到的各种id（产品组合id，产品id、策略组合id、策略id、账户组合id、账户id、交易账户id，交易员id）以及交易所代码、合约乘数等各种字段，这样以后用到这些字段的时候就不再需要从系统内查找填写，其他如成交数量、均价、手续费、订单状态等信息在得到交易所的回报之后继续填写，直到这张订单完结入库。这张订单会出现在整个交易过程的每一个环节，系统内通过指针或引用传递，系统间通过共享内存拷贝，用空间换取复杂度，一本万利。  

&emsp;&emsp; 复杂度是软件系统中最昂贵的成本，因此BetterQuant秉着"keep it simple stupid"的设计理念，在满足需求的前提下最大程度的控制系统的复杂度，用空间甚至用时间去换，类似上面的设计还有很多，比如说面向切面的事前风控插件子系统，可以通过配置像积木一样让你自由组合各个维度的无锁并行风控，用动态数组资源代替线程局部存储（线程内单例），这里就不一一列举了。接下来就由我这个在金融领域一线战斗了二十多年的it老兵带你一起体验BetterQuant的量化之旅。

### 作者
&emsp;&emsp;毕业于浙江大学数学系，二十余年金融it开发经验，大部分时间从事二级市场交易结算相关系统的研发工作，曾就职于国内头部金融it软件和金融数据服务供应商、为国内一线券商开发过交易柜台，在量化私募工作将近十年，在量化私募担任过首席架构师、技术总监等岗位。

