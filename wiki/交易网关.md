### 概述
&emsp;&emsp;交易网关主要负责连接外部的交易服务，每个交易网关会使用柜台提供的账号连接交易柜台，在收到内部子系统比如交易策略的报单请求之后，将报单请求转换为交易柜台能接受的格式并发送。  
&emsp;&emsp;交易网关同时负责账户层面请求的流控管理，如果是报单和撤单请求超出流控，那么会给报单发起方比如交易策略返回一个超出流控的状态码，如果是同步订单状态或者其他请求超出流控，那么系统会保存请求在若干秒后重新发起。  
&emsp;&emsp;由于有些api本地订单号是32位整型，而系统内部订单号是64位无符号整型，因此还在共享内存中维护了未完结的api本地订单号和系统内部订单号的对应关系，据此可以在收到回报之后根据api本地订单号找到系统内部订单，除此之外为了处理回报乱序的问题，还维护了最近完结的若干比api本地订单号和系统内部订单号的对应关系。  
&emsp;&emsp;系统在启动的时候会加载当前交易网关对应账号下所有交易账号的费率设置，同时有一个定时任务会检测数据库中费率配置信息，一有变化就重新加载，同时为了准确计算中金所
、大商所和郑商所的平今仓手续费，系统还在共享内存中维护了当日已开仓的合约列表。  
&emsp;&emsp;交易网关会还定时查询若干秒之前发起的未完结的订单信息，这个逻辑可以处理个别柜台漏发的回报，另外还可以在交易网关重启之后及时同步网关关闭期间未完结订单的状态变化信息。  
&emsp;&emsp;和行情网关类似，交易网关也有实盘和仿真两种模式，如果开启实盘模式，那么订单都会被发往交易柜台，如果开启仿真模式，那么订单都会被发往模拟成交模块处理。  

### 仿真模式  
将下面配置中的enabled改为true即可开启仿真模式：  

<img src="https://github.com/byrnexu/bq/assets/24740973/3cb38991-f96e-4e52-8a61-76880bd80dcc" width="800">   

开启仿真模式之后可以利用此功能进行回测，milliSecIntervalOfSimOrderStatus是一个订单每次发送不同的订单状态的回报的间隔。

### 接入新的交易柜台  
&emsp;&emsp;系统已经将接入柜台的各种通用部分的代码抽象分离出来放在交易网关基础类库中，通过交易网关基础类库，你可以快速的接入各种交易柜台。  
&emsp;&emsp;通过这个强大的交易网关基础类库，您可以毫不费力地接入多种交易柜台，无需为繁琐的接口细节烦忧。这意味着，您的交易策略可以更加专注和精准，而不必被特定柜台的限制所束缚。  
&emsp;&emsp;在金融市场中，机会稍纵即逝。交易网关基础类库为您提供了一个强有力的工具，让您在激烈的竞争中游刃有余，轻松应对各种挑战。  
