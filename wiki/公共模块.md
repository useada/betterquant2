### 概述
&emsp;&emsp;量化交易系统是一个比较庞大且复杂的系统，整个系统会用到很多通用的代码，为了合理有效的组织这些代码，系统按照其应用范围分成了若干个公共模块，包括libpub、libbqpub、libqtd-pub和libbqmd-pub等等。  

### 公共模块划分
&emsp;&emsp;量化交易系统是一个比较庞大且复杂的系统，整个系统会用到很多通用的代码，为了合理有效的组织这些代码，系统按照其应用范围分成了若干个公共模块，包括libpub、libbqpub、libqtd-pub和libbqmd-pub等等。  

|  模块名称   | 模块说明  |
|  ----  | ----  |
| libpub  | 和业务无关的一些通用的功能，比如字符串处理，日志记录等等 |
| libbqpub  | 和业务相关，行情或者交易相关子系统都会用到的功能 |
| libbqmd-pub  | 行情相关子系统都会用到的一些通用功能 |
| libbqtd-pub  | 交易相关子系统都会用到的一些通用功能 |
| libordmgr  | [订单管理](公共模块#订单管理) |
| libposmgr  | [仓位管理](公共模块#仓位管理) |
| libbqriskctrl  | [风控指标状态管理](公共模块#风控状态管理) |
| libbqipc  | [IPC模块](公共模块#进程间通信模块) |

&emsp;&emsp;关于通用代码的组织方式是这样的，比如说某一个函数，最初看起来像是只在行情相关子系统中会被用到，所以呢这个函数会被放在libbqmd-pub中，但是后来发现它在交易相关的子系统中也会被用到，于是这个函数就被“提升”到libbqpub模块中。  

&emsp;&emsp;公共模块除了通用代码的组织之外，还包括一些系统中最重要的公共模块，[订单管理](公共模块#订单管理) 模块和 [仓位管理](公共模块#仓位管理) 模块，这是系统中非常重要的两个模块，作为交易系统的最重要的风控和核算功能都是以这两个模块的数据为基础，可以说只要有了期初和实时行情，再加上这两个模块，我就能够做任何想要的和核算和风控功能。  

### 订单管理
&emsp;&emsp;订单管理模块主要负责处理在途订单，即未完结订单的管理和维护。这样，当有回报返回时，系统可以根据回报中的交易所订单号或本地订单号找到原始订单的详细信息。此外，在风控模块中，通过条件查询未完结订单，可以获取到冻结的资金和仓位的各个维度信息。策略引擎、交易服务中的风控模组、交易网关都有用到该模块。  
&emsp;&emsp;为了解决回报乱序的问题，订单管理模块还维护了最近完结的若干笔订单的信息。这样，即使回报到达的顺序有所混乱，最近已完结的订单的详细信息仍然可以从订单管理模块中准确获取。  
&emsp;&emsp;通过订单管理模块的高效维护和查询功能，系统能够更可靠地处理交易流程，并提供准确的交易数据和风控信息，为用户提供更稳健和安全的交易体验。    

### 仓位管理
&emsp;&emsp;仓位管理模块维护的是最小粒度的仓位明细信息信息。通过仓位管理模块，我们能够轻松地获取各个维度持仓的明细和汇总情况，比如策略层面、账户层面、产品层面等。策略引擎、交易服务中的风控模组都可以使用该模块获取仓位信息。  
&emsp;&emsp;该模块的重要性在于它提供了对交易仓位的全面掌控能力，使用户能够清晰地了解每个维度的持仓状况。通过完备的仓位信息用户可以做出更明智的投资决策，优化交易策略，以及更好地进行风险管理。  
&emsp;&emsp;仓位管理模块的高效运作为交易策略提供强大的支持，确保其交易活动能够更加精准和有效，从而实现更优秀的交易绩效。  

### 风控状态管理
&emsp;&emsp;风控状态管理功能在系统中起着至关重要的作用。它主要承担着风控指标在运行过程中所产生的多种关键中间状态的管理任务。这些状态涵盖了众多方面，其中包括但不限于流控情况、当日已开仓合约列表等等。  
&emsp;&emsp;例如在风控指标的执行过程中，我们需要密切关注流控情况，以确保交易活动在预设的范围内进行，避免过度交易造成不必要的风险。风控状态管理功能会细致地记录流控的状态信息，及时发现和响应流控情况，确保系统的交易活动始终在合理的范围内运行。  
&emsp;&emsp;这些中间状态的管理对于保障交易系统的稳健运行至关重要。风控状态管理功能在实践中不断优化和完善，以确保系统在复杂多变的市场环境中始终保持稳定和可靠。  

### 进程间通信模块
&emsp;&emsp;对开源项目iceoryx进行了二次封装，实现了通过共享内存传递各个子系统之间的数据，iceoryx 使用真正的零拷贝、共享内存方法，允许将数据从发布者传输到订阅者，而无需单个副本。iceoryx是一个很优秀的开源项目，不过对于BetterQuant来说相对重了一点，以后会考虑自行开发一个相对轻量级的ipc库，并且可以通过修改配置轻松的切换到tcp或者domain socket等通讯方式。  

