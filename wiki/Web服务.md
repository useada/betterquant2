### 概述

&emsp;&emsp;Web服务主要用于浏览器客户端的连接和请求处理，它提供了RESTful和WebSocket接口，并且已经内置解决了CORS跨域问题，主要功能包括：管理Web客户端连接和会话，处理客户端的各种请求，处理客户端的行情订阅请求并推送行情至客户端。


### RESTful接口

* 用户登录  
用户可以通过此接口发起登录请求。

* 用户登出  
用户可以通过此接口发起登出请求。

* 查询用户信息  
用于获取用户的相关信息。

* 查询历史行情  
用户可以通过此接口查询一个时间段内的行情，或者从某一个时间点往前或者往后若干条行情。

* 人工干预请求  
接收客户端发起的人工干预请求并将其转发至相应的交易策略。

* 通用SQL请求接口  
通用的SQL请求接口彻底解耦了几乎所有的客户都操作数据库相关的功能，客户端可以通过此接口调用各种存储过程或者sql语句，[前端功能](前端模块#前端功能) 基本上都是都通过通用SQL请求接口处理。

* 手工下单  
接收浏览器客户端发起的手工下单请求，并将其转发给手工单交易策略。

* 手工撤单  
接收浏览器客户端发起的手工撤单请求，并将其转发给手工单交易策略。

* 启动策略  
接收客户端启动策略请求，通过web服务创建交易策略子进程。

* 停止策略  
接收客户端启动策略请求，通过web服务停止交易策略子进程。

* 盈亏查询  
处理客户端查询实例层面的盈亏请求。

### websocket接口

* 用户连接注册  
用户通过WebSocket连接进行注册，web服务负责管理用户号和websocket连接的对应关系。

* 行情订阅  
接收用户的行情订阅请求，管理用户的行情订阅情况。

* 行情取消订阅  
接收用户的行情取消订阅请求。

Web服务的强大功能和丰富接口使得它成为一个理想的平台，能够满足多样化的用户需求。

### SQL查询结果缓存
&emsp;&emsp;由于客户端经常会发起各种各样的查询请求，有一些查询的结果很大且短时间内是固定的，对于实时性的要求不是那么高，为了降低数据库压力，web服务会将一些查询结果缓存起来，当收到客户端的通用SQL接口调用的时候，会先从SQL查询结果的缓存中获取，如果没有想要的结果，那么再从数据库中查询。  

<img src="https://github.com/byrnexu/bq/assets/24740973/0c321015-6658-4c1f-a179-b7cbb2e8016a" width="1000">

上面的配置文件中缓存了两个查询的结果及其缓存的有效期。

