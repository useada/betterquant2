### 概述
&emsp;&emsp;策略引擎目前以库的形式提供，包括一系列可调用的接口，用户可以通过调用策略引擎提供的接口创建交易策略，当然你也可以利用这些接口撰写非交易策略，比如一些pnl监控策略，所以说策略引擎不仅仅是策略的引擎，同时也是一个功能强大的异步任务并行处理框架。策略引擎除了行情订阅、取消订阅、下单等一系列常见的功能之外，还有很多金工在撰写策略过程中可能会用到的实用接口，具体的接口清单可以参考后面的 [策略引擎接口](策略引擎模块#策略引擎接口)。  
</br>  
&emsp;&emsp;对于策略而言，通常都包含若干个参数，每个参数有若干个取值，比如最常见的网格策略，有价格范围、网格数量、等差or等比等几个参数，上述的每个参数也可能会有若干个取值，因此在策略启动之后，肯定会有几套参数同时运行的场景，运行的过程中也可能会对这些参数进行调整，或者说增加一套参数组合，另外对于那些表现不好的参数，也可能会考虑将其关闭。  
</br>  
&emsp;&emsp;基于上述理由，BetterQuant将策略设计为一个策略包含若干个策略实例的形式，每个策略实例对应一套运行参数，为了最大程度的减少策略实例之间对于系统硬件资源的竞争，这些策略实例运行在一个线程池中，线程池的大小可以在策略的配置文件中设置。
```yaml
stgInstTaskDispatcherParam: moduleName=StgInstTaskDispatcher;taskRandAssignedThreadPoolSize=0;taskSpecificThreadPoolSize=4
```
修改策略配置中的 taskSpecificThreadPoolSize=4 即可调整运行的策略实例的线程池的大小，通常而言这个线程池的大小应该小于等于策略实例的数量，比如taskSpecificThreadPoolSize=4但是你只有两个策略实例，那么很明显是有问题的，因为有两个线程是闲置的。  
</br>  
&emsp;&emsp;因为策略实例运行在线程池中，所以 c++ 语言编写的策略的策略实例回调事件中要处理好一些共享数据的竞争问题（比如加锁），对于 python 编写的策略事件回调目前是串行的，所以无需处理竞争。 另外由于会有多个策略实例触发回调，因此在处理回调逻辑的时候要先加上条件判断，是哪个策略实例的 stgInstId 触发了此事件：
```python
def on_stg_inst_start(self, stg_inst_info):
    if stg_inst_info.stg_inst_id == 1:
        # sub market data of trades, note that the topic is case sensitive.
        self.stg_eng.sub(
            stg_inst_info.stg_inst_id, "shm://MD.SZSE.Spot/000002/Trades"
        )   
```
也可以用更具可读性策略实例名称去判断：
```python
    if stg_inst_info.stg_inst_name == "geometricGrid":
        # sub market data of trades, note that the topic is case sensitive.
        self.stg_eng.sub(
            stg_inst_info.stg_inst_id, "shm://MD.SZSE.Spot/000002/Trades"
        )   
```
在这一点上 c++ 和 python 没什么区别，策略实例编号 stgInstId 必须从1开始，每个策略也必须得有一个 stgInstId 为1的策略实例。策略实例编号和名称都不能重复。  
</br>    

&emsp;&emsp;为了更好的管理各种策略，系统对策略id的区间做了一个分区的管理：

|  策略id区间   | 策略id说明  |
|  ----  | ----  |
| 1  | 手拍单策略 |
| 8  | pnl动态跟踪策略 |
| [1,9000)  | 系统级策略预留区间 |
| [9000,10000)  | demo策略 |
| [10000,50000)  | 金工/交易员使用的策略id区间 |

</br>   

***

### 策略引擎接口
* [下单](策略引擎#下单)
* [撤单](策略引擎#撤单)
* [撤销策略所有挂单](策略引擎#撤销策略所有挂单)
* [撤销策略实例所有挂单](策略引擎#撤销策略实例所有挂单)
* [撤销一个算法单下所有订单](策略引擎#撤销一个算法单下所有订单)
* [创建一个算法单](策略引擎#创建一个算法单)
* [撤销一个算法单](策略引擎#撤销一个算法单)
* [订阅](策略引擎#订阅)
* [取消订阅](策略引擎#取消订阅)
* [安装一个固定时间的定时器](策略引擎#给策略实例安装一个固定时间的定时器)
* [安装一个间隔执行的定时器](策略引擎#给策略实例安装一个固定时间的定时器)
* [移除一个定时器](策略引擎#移除一个定时器)
* [获取订单信息](策略引擎#获取订单信息)
* [获取策略实例所有未完结订单](策略引擎#获取策略实例所有未完结订单)
* [获取策略实例仓位信息](策略引擎#获取策略实例仓位信息)
* [查两个时间点之间历史行情](策略引擎#查询两个时间点之间历史行情)
* [查某时间点之前的历史行情](策略引擎#查询某时间点之前的历史行情)
* [查某时间点之后的历史行情](策略引擎#查询某时间点之后的历史行情)
* [查两个时间点之间历史行情](策略引擎#根据topic查询两个时间点之间历史行情)
* [查某时间点之前的历史行情](策略引擎#根据topic查询某时间点之前的历史行情)
* [查某时间点之后的历史行情](策略引擎#根据topic查询某时间点之后的历史行情)
* [保存策略实例数据](策略引擎#保存策略实例数据)
* [加载策略实例数据](策略引擎#加载策略实例数据)
### 策略引擎回调
* [获取策略引擎对象](策略引擎#获取策略引擎对象)
* [人工干预指令处理](策略引擎#人工干预指令处理)
* [TOPIC推送](策略引擎#TOPIC推送)
* [委托回报](策略引擎#委托回报)
* [撤单应答](策略引擎#撤单应答)
* [逐笔成交](策略引擎#逐笔成交)
* [逐笔委托](策略引擎#逐笔委托)
* [订单簿](策略引擎#订单簿)
* [Candle](策略引擎#Candle)
* [Tickers](策略引擎#Tickers)
* [策略启动事件](策略引擎#策略启动事件)
* [策略实例启动事件](策略引擎#策略实例启动事件)
* [新增策略实例事件](策略引擎#新增策略实例事件)
* [移除策略实例事件](策略引擎#移除策略实例事件)
* [策略实例参数变化事件](策略引擎#策略实例参数变化事件)
* [策略实例定时器触发事件](策略引擎#策略实例定时器触发事件)
* [账户层面仓位变动信息](策略引擎#账户层面仓位变动信息)
* [账户层面仓位快照信息](策略引擎#账户层面仓位快照信息)
* [策略层面仓位变动信息](策略引擎#策略层面仓位变动信息)
* [策略层面仓位快照信息](策略引擎#策略层面仓位快照信息)
* [策略实例层面仓位变动信息](策略引擎#策略实例层面仓位变动信息)
* [策略实例层面仓位快照信息](策略引擎#策略实例层面仓位快照信息)
### 盈亏监控
* [盈亏的维度](策略引擎#盈亏的维度)
* [盈亏的监控](策略引擎#盈亏的监控)
### 仓位快照
* [仓位快照的维度](策略引擎#仓位快照的维度)
* [仓位的获取](策略引擎#仓位的获取)
### 系统策略
* [手拍单](策略引擎#手拍单)
